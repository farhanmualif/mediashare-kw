<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous" />
  </head>
  <body>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="display" class="w-25" style="display: none"></div>
    <div id="list-text"></div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      let socket = io();
      const display = document.getElementById("display");
      const list_text = document.getElementById("list-text");
      const name = document.getElementById("name");
      const message = document.getElementById("message");
      const nominal = document.getElementById("nominal");
      let duration;
      socket.on("newData", (data) => {
        console.log("play");
        display.style.display = "block";
        display.innerHTML = `<iframe
        id="existing-iframe-example"
        width="1024"
        height="768"
        src="https://www.youtube.com/embed/${getIDfromURL(
          data[0].linkMedia
        )}?autoplay=1&enablejsapi=1"
        frameborder="0"
        allow="autoplay"
        enabl
        style="border: solid 4px #37474f"></iframe>`;
        list_text.innerHTML = `
        <h1 id="name">${data[0].name}</h1>
        <h1 id="message">${data[0].message}</h1>
        <h1 id="nominal">${data[0].nominal}</h1>
        `;
        setTimeout(() => {
          document.getElementById("existing-iframe-example").remove();
          document.getElementById("name").remove();
          document.getElementById("message").remove();
          document.getElementById("nominal").remove();
          display.style.display = "none";
          console.log("done...");
        }, data[0].duration + 3);
      });

      function getIDfromURL(url) {
        const regExp =
          /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        const match = url.match(regExp);
        if (match && match[2].length === 11) {
          return match[2];
        }
        console.log("The supplied URL is not a valid youtube URL");
        return "";
      }
    </script>
  </body>
</html>
